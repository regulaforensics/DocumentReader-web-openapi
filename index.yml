openapi: 3.0.3
## add mark models as deprecated
info:
  version: 5.1.0
  title: Regula Document Reader Web API
  description: Regula Document Reader Web API

servers:
  - url: http://localhost:8080/
    description: Local on-premise installation
  - url: https://api.regulaforensics.com/
    description: Regula document reader SaaS
  - url: https://test-api.regulaforensics.com/
    description: Regula document reader test SaaS


paths:
  "/api/process":
    post:
      summary: Process list of documents images and return extracted data
      operationId: api-process
      requestBody:
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProcessRequest"
        required: true
      responses:
        "200":
          description: "Document reading result"
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ProcessResponse'
        "400":
          description: "Bad request. Check your input data. Currently do not return hints"
        "403":
          description: "Bad license. Either server or request contains not-valid license"

components:
  schemas:

    #############################
    ############################# Requests objects

    # todo different image input types
    ProcessRequest:
      type: object
      properties:
        processParam:
          $ref: '#/components/schemas/ProcessParams'
        List:
          type: array
          items:
            $ref: '#/components/schemas/ProcessRequestImage'
        systemInfo:
          $ref: '#/components/schemas/ProcessSystemInfo'
      required:
        - processParam
        - List

    # todo add other options https://github.com/regulaforensics/api/issues/102
    ProcessParams:
      type: object
      properties:
        scenario:
          $ref: './common.yml#/components/schemas/Scenario'
        resultTypeOutput:
          description: "Types of results to return in response. See 'Result' enum for available options."
          type: array
          items:
            $ref: './rt.yml#/components/schemas/Result'
      required:
        - scenario
      example:
        scenario: "FullProcess"
        resultTypeOutput: [1,6,9,15]

    ProcessRequestImage:
      type: object
      required:
        - ImageData
      properties:
        ImageData:
          $ref: './common.yml#/components/schemas/ImageData'
        LightIndex:
          $ref: './common.yml#/components/schemas/Light'
        page_idx:
          description: "page/image number"
          type: integer
          default: 0
      example:
        LightIndex: 6
        page_idx: 0
        ImageData:
          image: "<base64 image>"

    ProcessSystemInfo:
      type: object
      properties:
        license:
          description: "Base64 encoded license file"
          type: string
        recaptcha_token:
          description: "For internal use. Demo-sites recaptcha token."
          type: string

    #############################
    ############################# Response objects
    ProcessResponse:
      type: object
      required:
        - ProcessingFinished
        - ContainerList
        - TransactionInfo
        - ChipPage
      properties:
        ChipPage:
          $ref: "#/components/schemas/RfidLocation"
        ProcessingFinished:
          $ref: "#/components/schemas/ProcessingStatus"
        ContainerList:
          $ref: "./rt.yml#/components/schemas/ContainerList"
        TransactionInfo:
          $ref: "#/components/schemas/TransactionInfo"

    ProcessingStatus:
      type: integer
      enum:
        - 0
        - 1
        - 2
      x-enum-descriptions:
        - 'Processing was not finished'
        - 'Processing finished'
        - 'Processing finished by timeout'
      x-enum-varnames:
        - 'NOT_FINISHED'
        - 'FINISHED'
        - 'TIMEOUT'

    TransactionInfo:
      type: object
      properties:
        ComputerName:
          type: string
        DateTime:
          type: string
        TransactionID:
          type: string
        UserName:
          type: string
      example:
        ComputerName: "7cded6852d20"
        "DateTime": "2020-05-27T08:17:03.247Z"
        "TransactionID": "dc5eb444-ad6e-4ebc-8102-d62d5bb56a4e"
        "UserName": "user"
